-- Services
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

--// Main TDW Hub Frame
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "TDWHub"

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 650, 0, 400)
MainFrame.Position = UDim2.new(0.5, -325, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderColor3 = Color3.fromRGB(255, 0, 0)
MainFrame.BorderSizePixel = 2
MainFrame.Visible = true
MainFrame.Active = true
MainFrame.Draggable = true

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 10)

--// Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Text = "TDW Hub"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 0, 0)
Title.TextSize = 24
Title.Font = Enum.Font.SourceSansBold

--// Tabs
local Tabs = {}
local tabScriptBoxes = {}

local function createTab(name, order)
	local tab = Instance.new("TextButton", MainFrame)
	tab.Text = name
	tab.Size = UDim2.new(0, 120, 0, 30)
	tab.Position = UDim2.new(0, 10 + (order * 130), 0, 40)
	tab.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	tab.TextColor3 = Color3.fromRGB(255, 0, 0)
	tab.BorderColor3 = Color3.fromRGB(255, 0, 0)
	tab.TextSize = 18
	tab.Font = Enum.Font.SourceSansBold

	local corner = Instance.new("UICorner", tab)
	corner.CornerRadius = UDim.new(0, 6)

	Tabs[name] = tab
	return tab
end

--// Script Box Per Tab
local function setupTabScriptBox(tabName)
	local box = Instance.new("ScrollingFrame")
	box.Name = tabName .. "ScriptBox"
	box.Size = UDim2.new(0, 490, 0, 310)
	box.Position = UDim2.new(0, 130, 0, 80)
	box.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
	box.BorderColor3 = Color3.fromRGB(255, 0, 0)
	box.BorderSizePixel = 2
	box.CanvasSize = UDim2.new(0, 0, 0, 0)
	box.ScrollBarThickness = 4
	box.Visible = false
	box.Parent = MainFrame

	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0, 5)
	layout.SortOrder = Enum.SortOrder.LayoutOrder
	layout.Parent = box

	tabScriptBoxes[tabName] = {
		Frame = box,
		Layout = layout
	}
end

-- Show only one tab at a time
local function showTab(tabName)
	for name, data in pairs(tabScriptBoxes) do
		data.Frame.Visible = (name == tabName)
	end
end

-- Add tabs and setup script boxes
local MainTab = createTab("Main", 0)
local MiscTab = createTab("Misc", 1)
local LoopBringTab = createTab("LoopBring", 2)
local StatsTab = createTab("Stats", 3)

setupTabScriptBox("Main")
setupTabScriptBox("Misc")
setupTabScriptBox("LoopBring")
setupTabScriptBox("Stats")

-- Tab Button Click Events
MainTab.MouseButton1Click:Connect(function()
	showTab("Main")
end)
MiscTab.MouseButton1Click:Connect(function()
	showTab("Misc")
end)
LoopBringTab.MouseButton1Click:Connect(function()
	showTab("LoopBring")
end)
StatsTab.MouseButton1Click:Connect(function()
	showTab("Stats")
end)

-- Default Tab
showTab("Main")

-- Script Button Creator
local function createScriptButton(tabName, label, func)
	local container = tabScriptBoxes[tabName]
	if not container then
		warn("Tab not found:", tabName)
		return
	end

	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -10, 0, 30)
	btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	btn.BorderColor3 = Color3.fromRGB(255, 0, 0)
	btn.Text = label
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 16
	btn.TextColor3 = Color3.fromRGB(0, 255, 0)
	btn.Parent = container.Frame

	btn.MouseButton1Click:Connect(function()
		pcall(func)
	end)

	btn.MouseEnter:Connect(function()
		btn.TextColor3 = Color3.fromRGB(255, 0, 0)
	end)
	btn.MouseLeave:Connect(function()
		btn.TextColor3 = Color3.fromRGB(0, 255, 0)
	end)

	container.Frame.CanvasSize = UDim2.new(0, 0, 0, container.Layout.AbsoluteContentSize.Y + 10)
end

--// === Example Script Buttons by Tab ===

-- Main Scripts
createScriptButton("Main", "Infinite Yield", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
end)

createScriptButton("Main", "Dark Dex", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/peyton2465/Dex/master/out.lua"))()
end)

-- Misc Scripts
createScriptButton("Misc", "Simple Fly", function()
	loadstring(game:HttpGet("https://pastebin.com/raw/6cr7WhZp"))()
end)

createScriptButton("Misc", "Chat Bypass", function()
	print("Bypassed chat filter.")
end)

-- LoopBring Features
createScriptButton("LoopBring", "Bring Nearest", function()
	print("Loop bringing nearest player.")
end)

createScriptButton("LoopBring", "Set Bring Distance", function()
	print("Bring distance set to 10 studs.")
end)

-- Stats / Utility
createScriptButton("Stats", "FPS Booster", function()
	print("FPS Boosted.")
end)

createScriptButton("Stats", "Anti AFK", function()
	local vu = game:GetService("VirtualUser")
	game:GetService("Players").LocalPlayer.Idled:Connect(function()
		vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
		wait(1)
		vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
	end)
end)

-- LoopBring Button
local LoopBringButton = Instance.new("TextButton")
LoopBringButton.Size = UDim2.new(0, 100, 0, 25)
LoopBringButton.Position = UDim2.new(0, 0, 0, 0)
LoopBringButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
LoopBringButton.BorderColor3 = Color3.fromRGB(255, 0, 0)
LoopBringButton.Text = "[LoopBring]"
LoopBringButton.Font = Enum.Font.SourceSansBold
LoopBringButton.TextSize = 14
LoopBringButton.TextColor3 = Color3.fromRGB(255, 0, 0)
LoopBringButton.Parent = MainFrame

-- Divider under LoopBring and Tabs
local TopDivider = Instance.new("Frame")
TopDivider.Size = UDim2.new(1, 0, 0, 1)
TopDivider.Position = UDim2.new(0, 0, 0, 26)
TopDivider.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
TopDivider.BorderSizePixel = 0
TopDivider.Parent = MainFrame

-- Left Divider Line for LoopBring
local LeftDivider = Instance.new("Frame")
LeftDivider.Size = UDim2.new(0, 2, 1, -26)
LeftDivider.Position = UDim2.new(0, 100, 0, 26)
LeftDivider.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
LeftDivider.BorderSizePixel = 0
LeftDivider.Parent = MainFrame

-- Top Tabs
local function createTab(name, icon, position)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 80, 0, 25)
    btn.Position = UDim2.new(0, position, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Text = icon .. " " .. name
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.TextColor3 = Color3.fromRGB(0, 255, 0)
    btn.Parent = MainFrame

    -- Divider Line between buttons
    local divider = Instance.new("Frame")
    divider.Size = UDim2.new(0, 1, 1, 0)
    divider.Position = UDim2.new(1, 0, 0, 0)
    divider.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    divider.BorderSizePixel = 0
    divider.Parent = btn
end

createTab("Tips", "üß†", 110)
createTab("Main", "üíÄ", 190)
createTab("Misc", "üîß", 270)
createTab("Hubs", "üåê", 350)

-- TDW Title
local TDWFrame = Instance.new("Frame")
TDWFrame.Size = UDim2.new(0, 30, 1, -26)
TDWFrame.Position = UDim2.new(0, 35, 0, 26) -- Adjusted position (moved right)
TDWFrame.BackgroundTransparency = 1
TDWFrame.Parent = MainFrame

local sideLabels = {"T", "D", "W"}
for i, letter in ipairs(sideLabels) do
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 30, 0, 50)
    label.Position = UDim2.new(0, 0, 0, (i - 1) * 100 + 30)
    label.Text = letter
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 30
    label.TextColor3 = Color3.fromRGB(255, 0, 0)
    label.BackgroundTransparency = 1
    label.Parent = TDWFrame
end

-- Right Side Info Panel
local InfoPanel = Instance.new("Frame")
InfoPanel.Size = UDim2.new(0, 180, 1, 0)
InfoPanel.Position = UDim2.new(1, 0, 0, 0)
InfoPanel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
InfoPanel.BorderColor3 = Color3.fromRGB(255, 0, 0)
InfoPanel.BorderSizePixel = 2
InfoPanel.Visible = true
InfoPanel.Parent = MainFrame

-- Toggle InfoPanel button (now labeled "Stats")
local ToggleInfoButton = Instance.new("TextButton")
ToggleInfoButton.Size = UDim2.new(0, 50, 0, 20)
ToggleInfoButton.Position = UDim2.new(1, -50, 0, 0)
ToggleInfoButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ToggleInfoButton.BorderColor3 = Color3.fromRGB(255, 0, 0)
ToggleInfoButton.Text = "Stats"
ToggleInfoButton.Font = Enum.Font.SourceSansBold
ToggleInfoButton.TextSize = 14
ToggleInfoButton.TextColor3 = Color3.fromRGB(255, 0, 0)
ToggleInfoButton.Parent = MainFrame

ToggleInfoButton.MouseButton1Click:Connect(function()
    InfoPanel.Visible = not InfoPanel.Visible
end)

-- Username Display
local Username = Instance.new("TextLabel")
Username.Size = UDim2.new(1, 0, 0, 30)
Username.Position = UDim2.new(0, 0, 0, 5)
Username.Text = "User:\n" .. LocalPlayer.Name
Username.TextWrapped = true
Username.Font = Enum.Font.SourceSansBold
Username.TextSize = 14
Username.TextColor3 = Color3.fromRGB(0, 255, 0)
Username.BackgroundTransparency = 1
Username.Parent = InfoPanel

-- Avatar Image
local Avatar = Instance.new("ImageLabel")
Avatar.Size = UDim2.new(0, 80, 0, 80)
Avatar.Position = UDim2.new(0.5, -40, 0, 40)
Avatar.BackgroundTransparency = 1
Avatar.Image = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. LocalPlayer.UserId .. "&width=420&height=420&format=png"
Avatar.Parent = InfoPanel

-- Live FPS Label
local FPS = Instance.new("TextLabel")
FPS.Size = UDim2.new(1, 0, 0, 20)
FPS.Position = UDim2.new(0, 0, 0, 130)
FPS.Text = "FPS: 0"
FPS.Font = Enum.Font.SourceSansBold
FPS.TextSize = 18
FPS.TextColor3 = Color3.fromRGB(0, 255, 0)
FPS.BackgroundTransparency = 1
FPS.Parent = InfoPanel

-- Live Ping Label
local Ping = Instance.new("TextLabel")
Ping.Size = UDim2.new(1, 0, 0, 20)
Ping.Position = UDim2.new(0, 0, 0, 155)
Ping.Text = "Ping: 0ms"
Ping.Font = Enum.Font.SourceSansBold
Ping.TextSize = 18
Ping.TextColor3 = Color3.fromRGB(0, 255, 0)
Ping.BackgroundTransparency = 1
Ping.Parent = InfoPanel

-- Tool Count (future expansion)
local ToolCount = Instance.new("TextLabel")
ToolCount.Size = UDim2.new(1, 0, 0, 20)
ToolCount.Position = UDim2.new(0, 0, 0, 180)
ToolCount.Text = "Tools: 0"
ToolCount.Font = Enum.Font.SourceSansBold
ToolCount.TextSize = 18
ToolCount.TextColor3 = Color3.fromRGB(0, 255, 0)
ToolCount.BackgroundTransparency = 1
ToolCount.Parent = InfoPanel

-- Live Updater
RunService.RenderStepped:Connect(function()
    -- FPS
    local fps = math.floor(1 / RunService.RenderStepped:Wait())
    FPS.Text = "FPS: " .. tostring(fps)

    -- Ping
    local ping = LocalPlayer:GetNetworkPing() or 0
    Ping.Text = "Ping: " .. math.floor(ping * 1000) .. "ms"

    -- Tool Count
    local count = 0
    if LocalPlayer.Character then
        for _, tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
            if tool:IsA("Tool") then count += 1 end
        end
        for _, tool in ipairs(LocalPlayer.Character:GetChildren()) do
            if tool:IsA("Tool") then count += 1 end
        end
    end
    ToolCount.Text = "Tools: " .. count
end)

-- LoopBring Panel
local LoopBringPanel = Instance.new("Frame")
LoopBringPanel.Size = UDim2.new(0, 200, 1, -26)
LoopBringPanel.Position = UDim2.new(0, -200, 0, 26)
LoopBringPanel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
LoopBringPanel.BorderColor3 = Color3.fromRGB(255, 0, 0)
LoopBringPanel.BorderSizePixel = 2
LoopBringPanel.Visible = false
LoopBringPanel.Parent = MainFrame

-- Distance Manager
local DistanceLabel = Instance.new("TextLabel")
DistanceLabel.Size = UDim2.new(1, 0, 0, 30)
DistanceLabel.Position = UDim2.new(0, 0, 0, 0)
DistanceLabel.Text = "Distance: 5"
DistanceLabel.Font = Enum.Font.SourceSansBold
DistanceLabel.TextSize = 16
DistanceLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
DistanceLabel.BackgroundTransparency = 1
DistanceLabel.Parent = LoopBringPanel

local PlusButton = Instance.new("TextButton")
PlusButton.Size = UDim2.new(0, 30, 0, 30)
PlusButton.Position = UDim2.new(1, -60, 0, 0)
PlusButton.Text = "+"
PlusButton.Font = Enum.Font.SourceSansBold
PlusButton.TextSize = 18
PlusButton.TextColor3 = Color3.fromRGB(0, 255, 0)
PlusButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
PlusButton.BorderColor3 = Color3.fromRGB(255, 0, 0)
PlusButton.Parent = LoopBringPanel

local MinusButton = Instance.new("TextButton")
MinusButton.Size = UDim2.new(0, 30, 0, 30)
MinusButton.Position = UDim2.new(1, -30, 0, 0)
MinusButton.Text = "-"
MinusButton.Font = Enum.Font.SourceSansBold
MinusButton.TextSize = 18
MinusButton.TextColor3 = Color3.fromRGB(0, 255, 0)
MinusButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MinusButton.BorderColor3 = Color3.fromRGB(255, 0, 0)
MinusButton.Parent = LoopBringPanel

local currentDistance = 5
PlusButton.MouseButton1Click:Connect(function()
    currentDistance += 1
    DistanceLabel.Text = "Distance: " .. currentDistance
end)
MinusButton.MouseButton1Click:Connect(function()
    currentDistance = math.max(1, currentDistance - 1)
    DistanceLabel.Text = "Distance: " .. currentDistance
end)

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

local playerListFrame = Instance.new("Frame")
playerListFrame.Size = UDim2.new(1, 0, 1, -60)
playerListFrame.Position = UDim2.new(0, 0, 0, 40)
playerListFrame.BackgroundTransparency = 1
playerListFrame.Parent = LoopBringPanel

local selectedPlayers = {}

-- Create buttons for all players
local function refreshPlayerButtons()
    for _, child in pairs(playerListFrame:GetChildren()) do
        if child:IsA("TextButton") then child:Destroy() end
    end

    local yOffset = 0
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, 0, 0, 20)
            button.Position = UDim2.new(0, 0, 0, yOffset)
            button.BackgroundTransparency = 1
            button.Text = player.Name
            button.Font = Enum.Font.SourceSansBold
            button.TextSize = 14
            button.TextColor3 = Color3.fromRGB(0, 255, 0)
            button.Parent = playerListFrame

            button.MouseButton1Click:Connect(function()
                if selectedPlayers[player] then
                    selectedPlayers[player] = nil
                    button.TextColor3 = Color3.fromRGB(0, 255, 0)
                else
                    selectedPlayers[player] = true
                    button.TextColor3 = Color3.fromRGB(255, 0, 0)
                end
            end)

            yOffset += 22
        end
    end
end

-- Refresh when players join/leave
Players.PlayerAdded:Connect(refreshPlayerButtons)
Players.PlayerRemoving:Connect(refreshPlayerButtons)
refreshPlayerButtons()

-- LoopBring logic
RunService.Heartbeat:Connect(function()
    for player, _ in pairs(selectedPlayers) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and
           LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            player.Character.HumanoidRootPart.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -currentDistance)
        end
    end
end)

LoopBringButton.MouseButton1Click:Connect(function()
    LoopBringPanel.Visible = not LoopBringPanel.Visible
end)
