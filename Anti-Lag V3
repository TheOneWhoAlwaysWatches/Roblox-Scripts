-- Antilag

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local Terrain = Workspace:FindFirstChildOfClass("Terrain")

-- Iluminación estilo Infinity Yield Antilag, siempre noche
Lighting:ClearAllChildren()
Lighting.GlobalShadows = false
Lighting.FogEnd = 9e9
Lighting.Brightness = 0
Lighting.OutdoorAmbient = Color3.fromRGB(127, 127, 127)
Lighting.Ambient = Color3.fromRGB(127, 127, 127)
Lighting.ClockTime = 0 -- 0 = media noche permanente
Lighting.EnvironmentDiffuseScale = 0
Lighting.EnvironmentSpecularScale = 0

-- Si hay terreno, reducir su calidad
if Terrain then
    Terrain.WaterWaveSize = 0
    Terrain.WaterWaveSpeed = 0
    Terrain.WaterReflectance = 0
    Terrain.WaterTransparency = 0
end

-- Quitar luces, partículas, texturas, decals, etc.
for _, obj in ipairs(Workspace:GetDescendants()) do
    if obj:IsA("BasePart") then
        obj.Material = Enum.Material.SmoothPlastic
        obj.Reflectance = 0
    elseif obj:IsA("ParticleEmitter") or
           obj:IsA("Trail") or
           obj:IsA("Beam") or
           obj:IsA("Fire") or
           obj:IsA("Smoke") or
           obj:IsA("Sparkles") or
           obj:IsA("PointLight") or
           obj:IsA("SpotLight") or
           obj:IsA("SurfaceLight") or
           obj:IsA("Decal") or
           obj:IsA("Texture") then
        obj:Destroy()
    end
end

-- X-Ray para el mapa
for _, obj in ipairs(Workspace:GetDescendants()) do
    if obj:IsA("BasePart") and not obj:IsDescendantOf(LocalPlayer.Character) then
        obj.Transparency = 0.8
        obj.Material = Enum.Material.ForceField
        obj.CastShadow = false
    end
end

-- Eliminar accesorios, cabello, mochilas, colas, orejas, etc.
local function removeAccessories(character)
    for _, item in ipairs(character:GetDescendants()) do
        if item:IsA("Accessory") or item:IsA("Hat") or item:IsA("Hair") then
            item:Destroy()
        elseif item:IsA("Clothing") or item:IsA("Shirt") or item:IsA("Pants") or item:IsA("ShirtGraphic") then
            item:Destroy()
        elseif item:IsA("BasePart") then
            item.Transparency = 0.8
            item.Material = Enum.Material.ForceField
        end
    end
end

-- Ejecutarlo para todos los jugadores actuales
for _, player in ipairs(Players:GetPlayers()) do
    if player.Character then
        removeAccessories(player.Character)
    end
end

-- También para cuando reaparezcan los jugadores
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        task.wait(0.5)
        removeAccessories(character)
    end)
end)

for _, player in ipairs(Players:GetPlayers()) do
    player.CharacterAdded:Connect(function(character)
        task.wait(0.5)
        removeAccessories(character)
    end)
end

-- Establecer la cámara a modo optimizado
local cam = workspace.CurrentCamera
if cam then
    cam.FieldOfView = 70
end
