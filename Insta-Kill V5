-- ⚡ OPTIMIZED ULTRA INSTA-KILL — Frame-Synced
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- CONFIG
local auraSize = Vector3.new(40, 40, 40)
local doubleStrike = false

-- STATE
local myChar, myHRP
local running = false

-- Refresh self
local function refreshSelf()
    myChar = LocalPlayer.Character
    myHRP = myChar and myChar:FindFirstChild("HumanoidRootPart")
end

-- Tool strike
local function strikeTool(tool)
    if myChar and tool.Parent ~= myChar then
        tool.Parent = myChar
    end
    tool:Activate()
    local fightEvent = tool:FindFirstChild("FightEvent")
    if fightEvent then
        fightEvent:FireServer()
        if doubleStrike then fightEvent:FireServer() end
    end
end

-- Get touchpart
local function getTouchPart(tool)
    local tt = tool and tool:FindFirstChildWhichIsA("TouchTransmitter", true)
    return tt and tt.Parent
end

-- Kill loop
local function startLoop()
    running = true
    RunService.Heartbeat:Connect(function()
        if not running then return end
        refreshSelf()
        if not myChar or not myHRP then return end

        for _, tool in ipairs(myChar:GetChildren()) do
            if tool:IsA("Tool") then
                strikeTool(tool)

                local touchPart = getTouchPart(tool)
                if touchPart then
                    local parts = Workspace:GetPartBoundsInBox(
                        touchPart.CFrame,
                        touchPart.Size + auraSize
                    )
                    for _, part in ipairs(parts) do
                        if not myChar:IsAncestorOf(part) then
                            local model = part:FindFirstAncestorWhichIsA("Model")
                            if model then
                                firetouchinterest(touchPart, part, 1)
                                firetouchinterest(touchPart, part, 0)
                            end
                        end
                    end
                end
            end
        end
    end)
end

-- Reset handlers
LocalPlayer.CharacterAdded:Connect(function(char)
    running = false
    task.wait(0.1)
    char:WaitForChild("Humanoid")
    startLoop()
end)

if LocalPlayer.Character then
    startLoop()
end
